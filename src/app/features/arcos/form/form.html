<h2 class="text-2xl font-semibold mb-4">{{ id ? 'Editar arco' : 'Nuevo arco' }}</h2>

<div *ngIf="error" class="text-red-600 mb-3">{{ error }}</div>
<div *ngIf="loading">Cargando…</div>

<form [formGroup]="form" (ngSubmit)="guardar()" class="grid gap-4 max-w-2xl" *ngIf="!loading">
  <mat-form-field appearance="outline">
    <mat-label>Proceso</mat-label>
    <mat-select formControlName="procesoId" required>
      <mat-option *ngFor="let p of procesos" [value]="p.id">{{ p.nombre }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('procesoId')?.touched && form.get('procesoId')?.hasError('required')">
      El proceso es obligatorio
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Origen - Tipo</mat-label>
    <mat-select formControlName="origenTipo" required>
      <mat-option *ngFor="let t of tiposNodo" [value]="t">{{ t }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('origenTipo')?.touched && form.get('origenTipo')?.hasError('required')">
      El tipo de origen es obligatorio
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Origen - ID</mat-label>
    <input matInput type="number" formControlName="origenId" required>
    <mat-error *ngIf="form.get('origenId')?.touched && form.get('origenId')?.hasError('required')">
      El ID de origen es obligatorio
    </mat-error>
    <mat-error *ngIf="form.get('origenId')?.touched && form.get('origenId')?.hasError('min')">
      Debe ser un número válido mayor que 0
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Destino - Tipo</mat-label>
    <mat-select formControlName="destinoTipo" required>
      <mat-option *ngFor="let t of tiposNodo" [value]="t">{{ t }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('destinoTipo')?.touched && form.get('destinoTipo')?.hasError('required')">
      El tipo de destino es obligatorio
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Destino - ID</mat-label>
    <input matInput type="number" formControlName="destinoId" required>
    <mat-error *ngIf="form.get('destinoId')?.touched && form.get('destinoId')?.hasError('required')">
      El ID de destino es obligatorio
    </mat-error>
    <mat-error *ngIf="form.get('destinoId')?.touched && form.get('destinoId')?.hasError('min')">
      Debe ser un número válido mayor que 0
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" class="col-span-2">
    <mat-label>Condición (opcional)</mat-label>
    <input matInput formControlName="condicion" placeholder="e.g., monto > 1000">
  </mat-form-field>

  <div class="flex gap-2 col-span-2">
    <button mat-flat-button color="primary" [disabled]="form.invalid || loading">Guardar</button>
    <button mat-stroked-button type="button" routerLink="/arcos">Cancelar</button>
  </div>
</form>
